// Awesomplete - Lea Verou - MIT license
!function(t){function e(){t.$("input.awesomplete").forEach(function(t){new i(t)})}var i=function(e,s){var n=this;this.input=t(e),t.attributes(this.input,{autocomplete:"off","aria-autocomplete":"list"}),this.showHint=this.input.classList.contains("show-hint"),s=s||{},t.extend(this,t.extend({minChars:2,maxItems:10,autoFirst:!1,source:null,container:{},ul:{},filter:i.FILTER_CONTAINS,sort:i.SORT_BYLENGTH,item:i.ITEM,replace:i.REPLACE,hint:i.HINT},t.extend(s,t.data(this.input)))),this.index=-1,this.container=this.container.subject&&this.container.subject instanceof Element?t.set(this.container.subject,t.extend({className:-1===this.container.subject.className.split(" ").indexOf("awesomplete")?this.container.subject.className.split(" ").concat(["awesomplete"]).join(" "):this.container.subject.className},this.container,/^(?!subject)/)):t.create("div",t.extend({className:"awesomplete",around:this.input},this.container)),this.ul=this.ul.subject&&this.ul.subject instanceof Element?t.set(this.ul.subject,t.extend({hidden:"hidden"},this.ul,/^(?!subject)/)):t.create("ul",t.extend({hidden:"hidden",inside:this.container},this.ul)),this.status=t(".visually-hidden",this.container)instanceof Element?t(".visually-hidden",this.container):t.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-relevant":"additions",inside:this.container}),this.showHint&&(this.hint_input=t.create("input",{disabled:"disabled",type:"text",className:"form-control",inside:t.create("div",{className:"awesomplete-inputs",around:this.input})})),t.events(this.input,{input:this.evaluate.bind(this),blur:this.close.bind(this),keydown:function(t){var e=t.keyCode;n.opened&&(13===e&&n.selected?(t.preventDefault(),n.select()):27===e?n.close():(38===e||40===e)&&(t.preventDefault(),n[38===e?"previous":"next"]()))}}),t.events(this.input.form,{submit:this.close.bind(this)}),t.events(this.ul,{mousedown:function(t){var e=t.target;if(e!==this){for(;e&&!/li/i.test(e.nodeName);)e=e.parentNode;e&&0===t.button&&(t.preventDefault(),n.select(e,t.target))}}}),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||s.list||[],i.all.push(this)};i.prototype={set list(e){Array.isArray(e)?this._list=e:"string"==typeof e&&e.indexOf(",")>-1?this._list=e.split(/\s*,\s*/):(e=t(e),e&&e.children&&(this._list=s.apply(e.children).map(function(t){return t.textContent.trim()}))),document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return!this.ul.hasAttribute("hidden")},close:function(){this.ul.setAttribute("hidden",""),this.index=-1,t.fire(this.input,"awesomplete-close")},open:function(){this.ul.removeAttribute("hidden"),this.autoFirst&&-1===this.index&&this["goto"](0),t.fire(this.input,"awesomplete-open")},next:function(){var t=this.ul.children.length;this["goto"](this.index<t-1?this.index+1:-1)},previous:function(){var t=this.ul.children.length;this["goto"](this.selected?this.index-1:t-1)},"goto":function(e){var i=this.ul.children;this.selected&&i[this.index].setAttribute("aria-selected","false"),this.index=e,e>-1&&i.length>0&&(i[e].setAttribute("aria-selected","true"),i[e].scrollIntoView(!1),this.showHint&&(this.hint_input.value=this.hint(i[e])),this.status.textContent=i[e].textContent),t.fire(this.input,"awesomplete-highlight")},select:function(e,s){if(e=e||this.ul.children[this.index]){e.setAttribute("aria-selected","true");var n=t.fire(this.input,"awesomplete-select",{text:e.textContent,data:this.suggestions[i.siblingIndex(e)],origin:s||e});n&&(this.replace(e),this.hint_input.value="",this.close(),t.fire(this.input,"awesomplete-selectcomplete"))}},suggest:function(t){var e=this,i=this.input.value;this.suggestions=t,this.index=-1,this.ul.innerHTML="",t.forEach(function(t){e.ul.appendChild(e.item(t,i))}),0===this.ul.children.length&&this.close(),this.opened||this.open()},evaluate:function(){var e=this,i=this.input.value;if(i.length<this.minChars)return void this.close();if(this.source){if("function"!=typeof this.source)return;var s=this.source(i);Array.isArray(s)?this.suggest(s):"object"==typeof s&&t.fetch(s.url,t.extend({method:"GET",responseType:"json"},s,/^(?!url)/)).then(function(i){if(i.response){var s="string"==t.type(i.response)?JSON.parse(i.response):i.response;e.suggest(s.sort(e.sort).slice(0,e.maxItems))}})["catch"](function(t){console.error(t,"code: "+t.status)})}else this._list.length>0?this.suggest(this._list.filter(function(t){return e.filter(t,i)}).sort(this.sort).slice(0,this.maxItems)):this.close()}},i.all=[],i.FILTER_CONTAINS=function(t,e){return RegExp(i.regExpEscape(e.trim()),"i").test(t)},i.FILTER_STARTSWITH=function(t,e){return RegExp("^"+i.regExpEscape(e.trim()),"i").test(t)},i.SORT_BYLENGTH=function(t,e){return t.length!==e.length?t.length-e.length:e>t?-1:1},i.ITEM=function(e,s){var n=""===s?e:e.replace(RegExp(i.regExpEscape(s.trim()),"gi"),"<mark>$&</mark>");return t.create("li",{innerHTML:n,"aria-selected":"false"})},i.REPLACE=function(t){this.input.value=t.textContent},i.HINT=function(t){return t.textContent};var s=Array.prototype.slice;return i.regExpEscape=function(t){return t.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},i.siblingIndex=function(t){for(var e=0;t=t.previousElementSibling;e++);return e},"undefined"!=typeof Document&&("loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)),"undefined"!=typeof self&&(self.Awesomplete=i),"object"==typeof module&&module.exports&&(module.exports=i),i}(Bliss);
